<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>
</head>
<body>
  <div id="vis"/>
  <script>
    const spec = {
  "data": {
    "url": "https://raw.githubusercontent.com/sheriefAbdallah/CS318/refs/heads/main/Traffic_Incidents.csv",
    "format": {
      "type": "csv",
      "parse": {"acci_time": "date:'%d/%m/%Y %H:%M:%S'"}
    }
  },
  "hconcat": [
    {
      "title": "Total Number of Accidents Across Days of the Week",
      "mark": "bar",
      "encoding": {
        "x": {
          "timeUnit": "day",
          "field": "acci_time",
          "type": "nominal",
          "sort": ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
          "title": "Day of the Week "
        },
        "y": {
          "aggregate": "count",
          "field": "acci_id",
          "type": "quantitative",
          "title": "Number of Accidents"
        },
        "color": {
          "timeUnit": "day",
          "field": "acci_time",
          "type": "nominal",
          "title": "Days of the Week "
        },
        "tooltip": [
          {
            "timeUnit": "day",
            "field": "acci_time",
            "type": "nominal",
            "sort": ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
            "title": "Day of the Week "
          },
          {
            "aggregate": "count",
            "field": "acci_id",
            "type": "quantitative",
            "title": "Number of Accidents"
          }
        ]
      }
    },
    {
      "transform": [
        {"calculate": "hours(datum.acci_time)", "as": "hour"},
        {
          "calculate": "timeFormat(datum.acci_time, '%A')",
          "as": "day_of_the_week"
        }
      ],
      "mark": {type:"line",
        "point":{
            "filled":true,
            size:70
        }
      },

      "encoding": {
        "x": {
          "field": "hour",
          "type": "ordinal",
          "title": "Hour of the Day (0-23) ",
          "axis": {
            "values": [
              0,
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8,
              9,
              10,
              11,
              12,
              13,
              14,
              15,
              16,
              17,
              18,
              19,
              20,
              21,
              22,
              23
            ],
            "labelAngle": 0
          }
        },
        "y": {
          "aggregate": "count",
          "type": "quantitative",
          "title": "Number of Accidents"
        },
        "color": {
          "field": "day_of_the_week",
          "type": "nominal",
          "title": "Days of the Week",
          "sort": [
            "Monday",
            "Tuesday",
            "Wednesday",
            "Thursday",
            "Friday",
            "Saturday",
            "Sunday"
          ]
        },
        "tooltip": [
          {"field": "hour", "type": "quantitative", "title": "Hour"},
          {"field": "day_of_the_week", "type": "nominal", "title": "Day"},
          {"aggregate": "count", "type": "quantitative", "title": "Accidents"}
        ]
      },
      "title": "Traffic Accidents by the Time of Day and Weekdays",
      "config": {}
    },
    {
      "title": "Accident Density Map Across Dubai",
      "width": 600,
      "height": 400,
      "projection": {"type": "mercator"},
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/janab957/dubai-geojson/refs/heads/main/Dubai.geojson",
            "format": {"type": "json"}
          },
          "mark": {"type": "geoshape", "fill": "#f4f4f4", "stroke": "#e4e4e4"}
        },
        {
          "transform": [
            {"filter": "datum.acci_y > 23"},
            {"calculate": "round(datum.acci_x * 300) / 300", "as": "lat"},
            {"calculate": "round(datum.acci_y * 300) / 300", "as": "lon"},
            {
              "aggregate": [{"op": "count", "as": "total"}],
              "groupby": ["lat", "lon"]
            }
          ],
          "mark": {"type": "circle", "opacity": 0.4},
          "encoding": {
            "latitude": {"field": "lat", "type": "quantitative"},
            "longitude": {"field": "lon", "type": "quantitative"},
            "size": {"value": 12},
            "color": {
              "field": "total",
              "type": "quantitative",
              "title": "Accident Density",
              "scale": {
                "range": [
                  "#ffdb99",
                  "#ff6600",
                  "#cc0000",
                  "#660000",
                  "#0d0000"
                ],
                "type": "sqrt"
              }
            },
            "tooltip": [
              {"field": "lat", "title": "Lat"},
              {"field": "lon", "title": "Long"},
              {"field": "total", "title": "Accidents"}
            ]
          }
        }
      ]
    }
  ],
  "config": {}
};
    vegaEmbed("#vis", spec, {mode: "vega-lite"}).then(console.log).catch(console.warn);
  </script>
</body>
</html>
